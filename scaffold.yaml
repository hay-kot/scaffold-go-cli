# yaml-language-server: $schema=https://hay-kot.github.io/scaffold/schema.json
metadata:
  minimum_version: v0.6.1
messages:
  pre: |
    # Go urfave/cli/v3 Project Scaffold

    Generate boilerplate code for a new urfave/cli/v3 project.

  post: |
    # Get Started

    ```sh
    cd {{ .ProjectKebab }}
    task run -- hello
    ```
skip:
  - "*taskfile.yml"
  - "**/.scaffold/**/*.go"

each:
  - commands

questions:
  - name: "gomod"
    group: "default"
    prompt:
      message: "Go Module Path"
      description: "e.g. github.com/username/project"
  - name: "full_name"
    group: "default"
    prompt:
      message: "Developers Name"
      description: "For License and README"
    required: true
  - name: "description"
    group: "default"
    prompt:
      message: "Description"
      description: "A short description of the project"
      multi: true
    required: true
  - name: "open_source_license"
    group: "default"
    prompt:
      message: "License"
      description: "Choose a license for your project"
      default: "MIT license"
      options:
        - "MIT license"
        - "BSD license"
        - "ISC license"
        - "Apache Software License 2.0"
        - "GNU General Public License v3"

  - name: "commands"
    group: "cli"
    prompt:
      message: "Commands"
      description: "List of commands to generate (kebab case)"
      loop: true
    validate:
      min: 1
      match:
        regex: "^[a-z]+(-[a-z]+)*$"
        message: "inputs must be in kebab-case"

  - name: "features_cicd"
    group: "cli"
    prompt:
      message: "CI/CD"
      description: "Select CI/CD features to enable"
      multi: true
      default: ["Github Actions", "Renovate"]
      options:
        - "Github Actions"
        - "Renovate"

  - name: "features_publishing"
    group: "cli"
    prompt:
      message: "Publishing"
      description: "Select publishing targets"
      multi: true
      default: ["Docker", "Homebrew Tap"]
      options:
        - "Docker"
        - "Homebrew Tap"

  - name: "features_cli"
    group: "cli"
    prompt:
      message: "CLI Features"
      description: "Select CLI features to enable"
      multi: true
      options:
        - "File Logging"
        - "Config File"
        - "JSON Output"

  - name: "docker_registry_url"
    group: "docker"
    when: '{{ has "Docker" .features_publishing }}'
    prompt:
      message: "Docker Registry"
      description: "Registry package url (e.g ghcr.io/hay-kot/scaffold)"
      default: "ghcr.io"

  - name: "homebrew_owner"
    group: "homebrew_tap"
    when: '{{ has "Homebrew Tap" .features_publishing }}'
    prompt:
      message: "Homebrew Tap Owner"
      description: "Tap repository owner"
  - name: "homebrew_name"
    group: "homebrew_tap"
    when: '{{ has "Homebrew Tap" .features_publishing }}'
    prompt:
      message: "Homebrew Tap Name"
      description: "e.g. homebrew-scaffold-tap"
      default: "homebrew-"

computed:
  feature_gh_actions: '{{ has "Github Actions" .Scaffold.features_cicd }}'
  feature_renovate: '{{ has "Renovate" .Scaffold.features_cicd }}'

  feature_docker: '{{ has "Docker" .Scaffold.features_publishing }}'
  feature_homebrew_tap: '{{ has "Homebrew Tap" .Scaffold.features_publishing }}'
  feature_file_logging: '{{ has "File Logging" .Scaffold.features_cli }}'
  feature_config_file: '{{ has "Config File" .Scaffold.features_cli }}'
  feature_json_output: '{{ has "JSON Output" .Scaffold.features_cli }}'

delimiters:
  # since goreleaser uses go templates we can override the delimiters to make
  # templating easier for us.
  - glob: "*.goreleaser.yml"
    left: "[["
    right: "]]"
  - glob: "**/workflows/publish.yml"
    left: "[["
    right: "]]"

presets:
  test:
    Project: "cli-test"
    gomod: "github.com/username/project"
    full_name: "John Doe"
    description: "A new project"
    open_source_license: "MIT license"
    features_cicd:
      - "Github Actions"
      - "Renovate"
    features_publishing:
      - "Docker"
      - "Homebrew Tap"
    features_cli: []
    docker_registry_url: ghcr.io/hay-kot/scaffold-go-cli
    homebrew_owner: "hay-kot"
    homebrew_name: "homebrew-scaffold-go-cli-tap"
    commands:
      - "hello"
      - "goodbye"

features:
  - value: "{{ .Computed.feature_renovate }}"
    globs:
      - "**/renovate.json"
  - value: "{{ .Computed.feature_gh_actions }}"
    globs:
      - "**/workflows/**.yml"
  - value: "{{ .Computed.feature_config_file }}"
    globs:
      - "**/config/*.go"
  - value: "{{ .Computed.feature_homebrew_tap }}"
    globs:
      - "**/HOMEBREW_SETUP.md"
